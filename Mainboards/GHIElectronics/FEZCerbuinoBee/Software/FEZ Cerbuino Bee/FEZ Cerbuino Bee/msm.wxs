<?xml version="1.0" encoding="utf-8" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  
  <?include common.wxi?>

  <?ifdef NETMF41Supported ?>
  <?include $(var.SourcePath)..\$(var.ProjectPath)_41\Setup\wixparameters41.wxi?>
  <?endif ?>
  <?ifdef NETMF42Supported ?>
  <?include $(var.SourcePath)..\$(var.ProjectPath)_42\Setup\wixparameters42.wxi?>
  <?endif ?>
  
  <Module Id="id_mainboard_msm" Language="0" Version="$(var.MainboardSoftwareVersion)">

    <Package Id="$(var.guid_msm_package_id)" 
             InstallerVersion="100" 
             Languages="1033" 
             Manufacturer="$(var.FullManufacturer)" 
             SummaryCodepage="1252" 
             AdminImage="no" />

    <Property Id="ALLUSERS" Value="2"/>

    <Directory Id='TARGETDIR' Name='SourceDir'>
      
      <!--Files-->
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
        <Directory Id='id_dir_mfgr' Name='$(var.FullManufacturer)'>
          <Directory Id='id_dir_gdgtr' Name='!(loc.GadgeteerDirectoryName)'>
            <Directory Id='id_dir_mainboards' Name='!(loc.MainboardDirectoryName)'>
              <Directory Id='INSTALLDIR' Name='$(var.SafeMainboardName)'>

                <Component Id='id_comp_gadgeteerhardware' Guid='$(var.guid_msm_comp_gadgeteerhardware_id)'>
                  <File Id="id_file_gadgeteerhardware" Source="$(var.SourcePath)\GadgeteerHardware.xml" KeyPath="yes"/>
                </Component>

                <Directory Id="id_dir_resources" Name="Resources">
                  <Component Id="id_comp_resources" Guid="$(var.guid_msm_comp_resources_id)">
                    <File Id="id_file_res_image.jpg" Source="$(var.SourcePath)\Image.jpg" KeyPath="yes"/>
                  </Component>
                </Directory>

                <!-- NETMF 4.1 -->
                <!--<Directory Id="id_dir_netmf_41" Name="NETMF 4.1" FileSource="$(var.SourcePath)..\$(var.ProjectPath)_41\bin\Release\">
                  <Component Id="id_comp_files_41" Guid="$(var.guid_msm_comp_files_id_41)">
                    <File Id="id_file_binary_41" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                    <File Id="id_file_pdb_41" Name="$(var.OutputFileName).pdb" />
                    <File Id="id_file_xml_41" Name="$(var.OutputFileName).XML" />
                  </Component>

                  <Directory Id="id_dir_be_41" Name="be">
                    <Component Id="id_comp_files_be_41" Guid="$(var.guid_msm_comp_files_be_id_41)">
                      <File Id="id_file_be_binary_41" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_be_pdb_41" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_be_pdbx_41" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_be_pe_41" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>

                  <Directory Id="id_dir_le_41" Name="le">
                    <Component Id="id_comp_files_le_41" Guid="$(var.guid_msm_comp_files_le_id_41)">
                      <File Id="id_file_le_binary_41" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_le_pdb_41" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_le_pdbx_41" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_le_pe_41" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>
                </Directory>-->

                <!-- NETMF 4.2 -->
                <Directory Id="id_dir_netmf_42" Name="NETMF 4.2" FileSource="$(var.SourcePath)..\$(var.ProjectPath)_42\bin\Release\">
                  <Component Id="id_comp_files_42" Guid="$(var.guid_msm_comp_files_id_42)">
                    <File Id="id_file_binary_42" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                    <File Id="id_file_pdb_42" Name="$(var.OutputFileName).pdb" />
                    <File Id="id_file_xml_42" Name="$(var.OutputFileName).XML" />
                  </Component>

                  <Directory Id="id_dir_be_42" Name="be">
                    <Component Id="id_comp_files_be_42" Guid="$(var.guid_msm_comp_files_be_id_42)">
                      <File Id="id_file_be_binary_42" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_be_pdb_42" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_be_pdbx_42" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_be_pe_42" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>

                  <Directory Id="id_dir_le_42" Name="le">
                    <Component Id="id_comp_files_le_42" Guid="$(var.guid_msm_comp_files_le_id_42)">
                      <File Id="id_file_le_binary_42" Name="$(var.OutputFileName).dll" KeyPath="yes"/>
                      <File Id="id_file_le_pdb_42" Name="$(var.OutputFileName).pdb" />
                      <File Id="id_file_le_pdbx_42" Name="$(var.OutputFileName).pdbx" />
                      <File Id="id_file_le_pe_42" Name="$(var.OutputFileName).pe" />
                    </Component>
                  </Directory>
                </Directory>


              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <!--Registry stuff-->
      <!--NOTE: This is marked as win32 so that it puts it in the correct location in the registry on x64 machines with registry redirection-->
      <Component Id="id_comp_reg_key_netmf" Guid="$(var.guid_msm_comp_registry_id)" Win64="no">
        <RegistryValue Id="NetMicroFxAssemblyGAC41" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETMicroFramework\v4.1\AssemblyFoldersEx\$(var.OutputFileName)" Value="[INSTALLDIR]NETMF 4.1"/>
        <RegistryValue Id="NetMicroFxAssemblyGAC42" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETMicroFramework\v4.2\AssemblyFoldersEx\$(var.OutputFileName)" Value="[INSTALLDIR]NETMF 4.2"/>

        <!--For VS addins - the value should be the folder containing the gadgeteerhardware.xml -->
        <RegistryValue Id="VSAddinRegKey" Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\.NETGadgeteer\v2\HardwareDefinitionFolders\$(var.OutputFileName)" Value="[INSTALLDIR]" />
      </Component>
      
    </Directory>

  </Module>
</Wix>